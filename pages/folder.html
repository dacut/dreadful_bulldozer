<%!
import cherrypy
import dozer.dao as dao
import dozer.filesystem as fs
from dozer.jsonrpc import to_json
%><%page args="app, node" /><%
hierarchy = node.hierarchy

# Only display up to 5 path elements
if len(hierarchy) <= 5:
    displayed_hierarchy = hierarchy
else:
    displayed_hierarchy = [hierarchy[0], None] + hierarchy[-4:]
%>\
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../docs-assets/ico/favicon.png">
    <title>${node.full_name | h}</title>
    <link href="/static/bootstrap.css" rel="stylesheet">
    <link href="/static/folder.css" rel="stylesheet">
    <script type="text/javascript"><!--
node = ${to_json(node)};
node_contents = ${to_json(node.children)};
--></script>
  </head>
  <body>
<%include file="/navbar.html" args="active_target='browse'" />
    <div class="container">
      <ol class="breadcrumb">
% for h in displayed_hierarchy:
<% name = h.name if h.node_id != 0 else "[root]" %>\
%     if h is None:
        <li>...</li>
%     elif h is node:
        <li class="active">${name | h}</li>
%     else:
        <li><a href="/files${h.full_name | h}">${name | h}</a></li>
%     endif
% endfor
      </ol>
      <div class="row">
        <div class="col-md-3 hidden-sm">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Actions</h3>
            </div>
            <div class="panel-body">
% if node.access(fs.PERM_CREATE_CHILD):
              <a href="#" id="createFolder" data-toggle="modal"
                 data-target="#createFolderDialog">Create folder</a><br>
              <a href="#" id="createNotepage">Create notepage</a><br>
% else:
              <span class="disabled"><abbr title="You do not have permissions to create folders in this folder">Create folder</abbr><br>
              <span class="disabled"><abbr title="You do not have permissions to create notepages in this folder">Create notepage</abbr><br>
% endif
            </div>
          </div>
        </div>
        <div class="col-md-9 col-xs-12">
          <table class="table table-striped">
            <tr id="folderListHeader"><th width="30px">&nbsp;</th><th>Filename</th><th>Type</th></tr>
            <tr id="folderListSizeRow" class="folderListSize"><td>&nbsp;</td>\
<td id="folderListSize" colspan="2"></td></tr>
          </table>
        </div>
      </div>
    </div>

    <!-- Modal dialog for create_folder() -->
    <div class="modal fade" id="createFolderDialog" tabindex="-1"
         role="dialog" aria-labelledby="createFolderDialogLabel"
         aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"
                    aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="createFolderDialogLabel">Create
              folder</h4>
          </div>
          <div class="modal-body">
            <form role="form">
              <div class="form-group">
                <label for="folderName">Folder name</label>
                <input type="text" class="form-control" id="folderName"
                       placeholder="Enter folder name">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn"
                    data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary btn-default"
                    id="createFolderAction">Create
              folder</button>
          </div>
        </div>
      </div>
    </div>
    <script src="/static/jquery-1.10.2.min.js"></script>
    <script src="/static/bootstrap.min.js"></script>
    <script src="/static/json2.js"></script>
    <script src="/static/dozerapi.js"></script>
    <script src="/static/folder.js"></script>
  </body>
</html>
